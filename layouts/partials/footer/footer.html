{{- $ThemeVersion := "3.6.0" -}}
<footer class="site-footer">
    <section class="copyright">
        &copy;
        {{ if and (.Site.Params.footer.since) (ne .Site.Params.footer.since (int (now.Format "2006"))) }}
        {{ .Site.Params.footer.since }} -
        {{ end }}
        {{ now.Format "2006" }} {{ .Site.Title }}
    </section>

    <section class="powerby">
        {{ with .Site.Params.footer.customText }}
        {{ . | safeHTML }} <br />
        {{ end }}

        {{- $Generator := `<a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>` -}}
        {{- $Theme := printf `<b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
                data-version="%s">Stack</a></b>` $ThemeVersion -}}
        {{- $DesignedBy := `<a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>` -}}

        {{ T "footer.builtWith" (dict "Generator" $Generator) | safeHTML }} <br />
        {{ T "footer.designedBy" (dict "Theme" $Theme "DesignedBy" $DesignedBy) | safeHTML }}
        <br />
        <a href="https://beian.miit.gov.cn/" target="_blank">赣ICP备17015735号</a>
    </section>
    {{ if .Store.Get "hasMermaid" }}
    <script src="/js/lib/mermaid.min.js"></script>
    <script>
        // Check if the system prefers dark mode
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        // Check if the HTML element has a 'dark' class (theme specific)
        const isDark = document.documentElement.classList.contains('dark');
        
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: (prefersDark || isDark) ? "dark" : "default"
        });

        // Listen for theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            mermaid.initialize({ 
                startOnLoad: true, 
                theme: e.matches ? "dark" : "default"
            });
        });
    </script>
    {{ end }}
</footer>