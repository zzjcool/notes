<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>zzj的笔记</title><link>/</link><description>Recent content on zzj的笔记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 20 Feb 2022 18:04:30 +0800</lastBuildDate><atom:link href="/index.xml" rel="self" type="application/rss+xml"/><item><title>业务性能优化，Reduce库实现</title><link>/p/%E4%B8%9A%E5%8A%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96reduce%E5%BA%93%E5%AE%9E%E7%8E%B0/</link><pubDate>Sun, 20 Feb 2022 18:04:30 +0800</pubDate><guid>/p/%E4%B8%9A%E5%8A%A1%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96reduce%E5%BA%93%E5%AE%9E%E7%8E%B0/</guid><description>&lt;p>在业务中我们可能经常会遇到某个接口需要高频的调用，例如数据库更新、插入操作，调用某api，在这里每一次的调用都会有额外的成本，所以无论是数据库还是一些api调用接口，都提供了批量操作的方式，通过批量操作来降低开销，提升效率。&lt;/p>
&lt;p>有的旧代码，或者业务本身不支持批量操作，所以我们需要对相关的数据进行聚合，转换为批量操作，个人认为这种操作有点类似于MapReduce操作中的Reduce，所以暂且称之为Reduce吧。&lt;/p>
&lt;h2 id="需求">需求&lt;/h2>
&lt;p>提供一个缓存，每次将单次的操作加入到这个缓存中，之后一次性从缓存中取出所有的数据，进行批量操作。&lt;/p>
&lt;p>当然何时将缓存全部取出来并进行操作也是个问题，所以我们希望可以传入两个值：&lt;/p>
&lt;ul>
&lt;li>&lt;code>maxSize&lt;/code>:表示缓存的最大大小&lt;/li>
&lt;li>&lt;code>refreshMillisecond&lt;/code>:表示缓存刷新的最短周期&lt;/li>
&lt;/ul>
&lt;p>也就是可以有两个条件可以触发批量操作，一个是固定时间，一个是达到缓存上限。&lt;/p>
&lt;p>为了模拟原来单次操作产生的阻塞，所以也应当支持阻塞，当该批所有的数据被批量处理完成后，代码可以执行下一步逻辑。&lt;/p>
&lt;p>同时应当可以捕获返回的错误，便于后续的处理。&lt;/p>
&lt;h2 id="接口设计">接口设计&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">type&lt;/span> &lt;span class="nx">ReduceWait&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">Wait&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">error&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">Interface&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">Add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{})&lt;/span> &lt;span class="nx">ReduceWait&lt;/span>
&lt;span class="nf">Destroy&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>对于Reduce核心操作就是&lt;code>Add&lt;/code>，其作用就是将数据插入到cache中，之后返回个ReduceWait接口。&lt;/p>
&lt;p>&lt;code>ReduceWait&lt;/code>接口只有一个方法&lt;code>Wait() error&lt;/code>，当插入数据后，可以调用这个方法产生阻塞，等待到内部的数据被消费后将返回error类型。&lt;/p>
&lt;h2 id="实现细节">实现细节&lt;/h2>
&lt;p>具体实现部分主要是交由&lt;code>ReduceImple&lt;/code>结构体来实现。除了实现Interface的接口的方法外，还有：&lt;/p>
&lt;ul>
&lt;li>daemon：负责定时处理cache中积压的数据&lt;/li>
&lt;li>refresh 刷新cache中所有的数据，将数据进行批量消费&lt;/li>
&lt;/ul>
&lt;p>在refresh的时候应当对Add操作上锁，保证同一时间只有一个refresh，或者Add在执行。&lt;/p>
&lt;p>同时比较麻烦的地方是调用Add的时候可能会因为Cache满了调用refresh，调用refresh的时候要保证没有其他的Add改变cache，所以Add需要一把锁
而refresh需要一把读写锁，其中refresh的读锁给Add。&lt;/p>
&lt;p>Add返回的Wait我们使用casewait实现，每次refresh将原来的阻塞接触，开启新的casewait即可。&lt;/p>
&lt;p>在初始化的时候需要传入一个&lt;code>HandleFunc&lt;/code>，这个函数的签名为&lt;code>type HandleFunc func(datas []interface{}) error&lt;/code>
会在每一次的refresh操作中被调用，这里返回的error会被上抛到wait返回。&lt;/p>
&lt;h2 id="使用方式">使用方式&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// import (
&lt;/span>&lt;span class="c1">// &amp;#34;github.com/zzjcool/goutils/reduce&amp;#34;
&lt;/span>&lt;span class="c1">// )
&lt;/span>&lt;span class="c1">// refresh调用的函数
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">doFunc&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">datas&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kd">interface&lt;/span>&lt;span class="p">{})&lt;/span> &lt;span class="kt">error&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">datas&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// 创建一个reduce，300ms刷新一次，同时最大容量是100
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">rdc&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">reduce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">doFunc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">// 加入一个数据，同时同步等待完成，如果不调用就是异步操作
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rdc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;test&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nf">Wait&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="仓库地址">仓库地址&lt;/h2>
&lt;p>&lt;a class="link" href="https://github.com/zzjcool/goutils/tree/main/reduce" target="_blank" rel="noopener"
>https://github.com/zzjcool/goutils/tree/main/reduce&lt;/a>&lt;/p></description></item><item><title>辣椒炒肉</title><link>/p/%E8%BE%A3%E6%A4%92%E7%82%92%E8%82%89/</link><pubDate>Tue, 15 Feb 2022 12:06:06 +0800</pubDate><guid>/p/%E8%BE%A3%E6%A4%92%E7%82%92%E8%82%89/</guid><description>&lt;img src="/p/%E8%BE%A3%E6%A4%92%E7%82%92%E8%82%89/ljcr.jpg" alt="Featured image of post 辣椒炒肉" />&lt;h2 id="材料准备">材料准备&lt;/h2>
&lt;ul>
&lt;li>主料
&lt;ul>
&lt;li>辣椒&lt;/li>
&lt;li>猪肉&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>辅料
&lt;ul>
&lt;li>小米椒&lt;/li>
&lt;li>玉米淀粉&lt;/li>
&lt;li>油&lt;/li>
&lt;li>糖&lt;/li>
&lt;li>盐&lt;/li>
&lt;li>生抽&lt;/li>
&lt;li>老抽&lt;/li>
&lt;li>鸡精&lt;/li>
&lt;li>大蒜&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="准备工作">准备工作&lt;/h2>
&lt;ol>
&lt;li>将猪肉切成丝，加入少量老抽和生抽，玉米淀粉腌制，使用淀粉腌制过的猪肉会更加的嫩，腌制十分钟左右就可以。&lt;/li>
&lt;li>辣椒切开，掏出辣椒籽，放一旁备用，根据自己喜好可以加入适量来额小米椒。&lt;/li>
&lt;li>大蒜切粒。&lt;/li>
&lt;/ol>
&lt;h2 id="制作流程">制作流程&lt;/h2>
&lt;ol>
&lt;li>热锅，加入食用油，等待油热。&lt;/li>
&lt;li>将腌制的猪肉倒入锅中，大火翻炒，炒至变色后关火。&lt;/li>
&lt;li>将肉倒出，放一旁备用。&lt;/li>
&lt;li>剩下的油继续开火，放入大蒜。&lt;/li>
&lt;li>等待有香味后加入辣椒翻炒。&lt;/li>
&lt;li>炒一会后倒入之前的肉，加少量的糖。&lt;/li>
&lt;li>加入适量的鸡精、盐、生抽以及少量老抽提色。&lt;/li>
&lt;li>翻炒后出锅&lt;/li>
&lt;/ol>
&lt;h2 id="成品总结">成品总结&lt;/h2>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 126;
flex-basis: 304px"
>
&lt;a href="/p/%E8%BE%A3%E6%A4%92%E7%82%92%E8%82%89/ljcr.jpg" data-size="1618x1276">
&lt;img src="/p/%E8%BE%A3%E6%A4%92%E7%82%92%E8%82%89/ljcr.jpg"
width="1618"
height="1276"
srcset="/p/%E8%BE%A3%E6%A4%92%E7%82%92%E8%82%89/ljcr_hu5ecfe790bedc4bd537f2edf54cfd5a05_316058_480x0_resize_q75_box.jpg 480w, /p/%E8%BE%A3%E6%A4%92%E7%82%92%E8%82%89/ljcr_hu5ecfe790bedc4bd537f2edf54cfd5a05_316058_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="辣椒炒肉">
&lt;/a>
&lt;figcaption>辣椒炒肉&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>第一次炒，肉放的太多了（主要还是盒马上买的一份辣椒份量实在是太少了），然后上海这里的辣椒都不是很辣，即使加入了小米椒，辣度还是有限。&lt;/p>
&lt;p>总体来说味道还是很不错的，从小最喜欢的一道菜。&lt;/p></description></item><item><title>Nginx 相关配置</title><link>/p/nginx-%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/</link><pubDate>Fri, 07 Jan 2022 10:33:38 +0800</pubDate><guid>/p/nginx-%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/</guid><description>&lt;h2 id="docker启动nginx">Docker启动Nginx&lt;/h2>
&lt;p>可以使用docker-compose快速的启动Nginx
docker-compose.yaml文件：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;3&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">nginx&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">network_mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;host&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">./nginx:/etc/nginx/conf.d&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unless-stopped&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以在当前目录下的nginx目录添加任意配置&lt;/p>
&lt;h2 id="nginx-反向代理websocket">Nginx 反向代理Websocket&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx"> &lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kn">listen&lt;/span> &lt;span class="mi">48265&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">server_name&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://domain:48265&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_http_version&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="s">.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">&amp;#34;Upgrade&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>最后一行配置可以转发ws&lt;/p>
&lt;p>有时候我们的nginx反向代理会出错，但是我们检查发现上游服务器是正常的，那这可能
是因为反向代理后端发生dns解析的变动（如k8s服务重启或者ddns），所以
需要配置nginx的dns解析（resolver 8.8.8.8），同时反向代理的后端地址需要写为变量：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx"> &lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kn">listen&lt;/span> &lt;span class="mi">48265&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">server_name&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">resolver&lt;/span> &lt;span class="mi">119&lt;/span>&lt;span class="s">.29.29.29&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="s">.8.8.8&lt;/span> &lt;span class="s">valid=30s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">set&lt;/span> &lt;span class="nv">$proxy_pass_url&lt;/span> &lt;span class="s">http://domain:48265&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kn">proxy_pass&lt;/span> &lt;span class="nv">$proxy_pass_url&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_http_version&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="s">.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">&amp;#34;Upgrade&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nginx-直接显示系统目录">Nginx 直接显示系统目录&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kn">listen&lt;/span> &lt;span class="mi">8880&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">listen&lt;/span> &lt;span class="s">[::]:8880&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">server_name&lt;/span> &lt;span class="s">domain.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="kn">root&lt;/span> &lt;span class="s">/data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">autoindex&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">autoindex_exact_size&lt;/span> &lt;span class="no">off&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">autoindex_localtime&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="kn">charset&lt;/span> &lt;span class="s">utf-8,gbk&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中&lt;code>root /data&lt;/code>表示实际的目录位置&lt;/p></description></item><item><title>Golang 内置包常用方法</title><link>/p/golang-%E5%86%85%E7%BD%AE%E5%8C%85%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/</link><pubDate>Tue, 04 Jan 2022 19:43:41 +0800</pubDate><guid>/p/golang-%E5%86%85%E7%BD%AE%E5%8C%85%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/</guid><description>&lt;h2 id="neturl">net/url&lt;/h2>
&lt;h3 id="添加query">添加query&lt;/h3>
&lt;p>原本有url:&lt;a class="link" href="http://domain.com" target="_blank" rel="noopener"
>http://domain.com&lt;/a>,
现在想要添加query参数变成:&lt;a class="link" href="http://domain.com?key=value" target="_blank" rel="noopener"
>http://domain.com?key=value&lt;/a>&lt;/p>
&lt;p>可以自己写一个方法去添加query参数。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">TestURL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">testing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">api&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">url&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;http://domain.com&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">URLAddQuery&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">api&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;key&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">api&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">String&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// URLAddQuery 提供一个URL，然后添加query参数
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">URLAddQuery&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">addr&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">url&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">URL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">value&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">query&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">addr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Query&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">query&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">addr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">RawQuery&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">query&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Encode&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="url拼接path">url拼接path&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go"> &lt;span class="nx">api&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">url&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;http://domain.com&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">api&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Path&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;/api/test&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>